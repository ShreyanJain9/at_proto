<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: ATProto::TID
  
    &mdash; AT Protocol for Ruby
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "ATProto::TID";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (T)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../ATProto.html" title="ATProto (module)">ATProto</a></span></span>
     &raquo; 
    <span class="title">TID</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: ATProto::TID
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName"><a href="https://docs.ruby-lang.org/en/2.3.0/Object.html">Object</a></span>
      
        <ul class="fullTree">
          <li><a href="https://docs.ruby-lang.org/en/2.3.0/Object.html">Object</a></li>
          
            <li class="next">ATProto::TID</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  <dl>
      <dt>Extended by:</dt>
      <dd>T::Sig</dd>
  </dl>
  
  
  
  <dl>
      <dt>Includes:</dt>
      <dd><a href="https://docs.ruby-lang.org/en/2.3.0/Comparable.html">Comparable</a></dd>
  </dl>
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/at_protocol/tid_ext.rb<span class="defines">,<br />
  ext/at_protocol/tid.c</span>
</dd>
  </dl>
  
</div>








  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#from_string-class_method" title="from_string (class method)">.<strong>from_string</strong>(str)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#str%3F-class_method" title="str? (class method)">.<strong>str?</strong>(s = nil)  &#x21d2; Boolean, Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>For use in case statements, so you can see if a string is a valid TID.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#<=>-instance_method" title="#&lt;=&gt; (instance method)">#<strong>&lt;=&gt;</strong>(other)  &#x21d2; Integer </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clock_id-instance_method" title="#clock_id (instance method)">#<strong>clock_id</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(*args)  &#x21d2; Object </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#succ-instance_method" title="#succ (instance method)">#<strong>succ</strong>  &#x21d2; ATProto::TID </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_s-instance_method" title="#to_s (instance method)">#<strong>to_s</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_time-instance_method" title="#to_time (instance method)">#<strong>to_time</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(*args)  &#x21d2; <tt><a href="https://docs.ruby-lang.org/en/2.3.0/Object.html">Object</a></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>clock_identifier_arg</span>
      
      
        <span class='type'>(<tt><a href="https://docs.ruby-lang.org/en/2.3.0/Fixnum.html">Fixnum</a></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The clock identifier to use</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/at_protocol/tid.c', line 24</span>

static VALUE tid_initialize(int argc, VALUE *argv, VALUE self) {
  VALUE time_arg = Qnil;
  VALUE clock_identifier_arg = Qnil;
  rb_scan_args(argc, argv, &quot;02&quot;, &amp;time_arg, &amp;clock_identifier_arg);

  TID *tid;
  Data_Get_Struct(self, TID, tid);

  if (NIL_P(time_arg)) {
    struct timeval tv;
    gettimeofday(&amp;tv, NULL);
    tid-&gt;timestamp = (uint64_t)tv.tv_sec * 1000000 + (uint64_t)tv.tv_usec;
  } else {
    if (!rb_obj_is_kind_of(time_arg, rb_cTime)) {
      rb_raise(rb_eTypeError, &quot;Argument must be a Time object or nil&quot;);
      return Qnil;
    }

    struct timeval tv;
    tv.tv_sec = NUM2LONG(rb_funcall(time_arg, rb_intern(&quot;tv_sec&quot;), 0));
    tv.tv_usec = NUM2LONG(rb_funcall(time_arg, rb_intern(&quot;tv_usec&quot;), 0));
    tid-&gt;timestamp = (uint64_t)tv.tv_sec * 1000000 + (uint64_t)tv.tv_usec;
  }

  if (NIL_P(clock_identifier_arg)) {
    tid-&gt;clock_identifier = rand() &amp; 0x3FF;
  } else {
    if (FIXNUM_P(clock_identifier_arg)) {
      tid-&gt;clock_identifier = NUM2LL(clock_identifier_arg) &amp; 0x3FF;
    } else {
      rb_raise(rb_eTypeError, &quot;Clock identifier must be a Fixnum or nil&quot;);
      return Qnil;
    }
  }

  return self;
}</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="from_string-class_method">
  
    .<strong>from_string</strong>(str)  &#x21d2; <tt><a href="https://docs.ruby-lang.org/en/2.3.0/Object.html">Object</a></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/at_protocol/tid.c', line 95</span>

static VALUE tid_from_string(VALUE klass, VALUE str) {
  Check_Type(str, T_STRING);

  TID *tid;
  VALUE tid_obj = Data_Make_Struct(klass, TID, NULL, xfree, tid);

  if (RSTRING_LEN(str) != 13) {
    rb_raise(rb_eArgError, &quot;TID string must be 13 characters long&quot;);
    return Qnil;
  }

  char tid_str[14];
  strncpy(tid_str, StringValueCStr(str), sizeof(tid_str));
  tid_str[13] = &#39;\0&#39;;

  // Extract timestamp and clock identifier
  uint64_t timestamp = 0;
  uint64_t clock_identifier = 0;
  for (int i = 0; i &lt; 11; i++) {
    char c = tid_str[i];
    const char *pos = strchr(b32_chars, c);
    if (pos == NULL) {
      rb_raise(rb_eArgError, &quot;Invalid character in TID string&quot;);
      return Qnil;
    }
    int index = (int)(pos - b32_chars);
    timestamp = (timestamp &lt;&lt; 5) | (index &amp; 0x1F);
  }

  for (int i = 11; i &lt; 13; i++) {
    char c = tid_str[i];
    const char *pos = strchr(b32_chars, c);
    if (pos == NULL) {
      rb_raise(rb_eArgError, &quot;Invalid character in TID string&quot;);
      return Qnil;
    }
    int index = (int)(pos - b32_chars);
    clock_identifier = (clock_identifier &lt;&lt; 5) | (index &amp; 0x1F);
  }

  tid-&gt;timestamp = timestamp;
  tid-&gt;clock_identifier = clock_identifier;

  return tid_obj;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="str?-class_method">
  
    .<strong>str?</strong>(s = nil)  &#x21d2; <tt>Boolean</tt>, <tt><a href="https://docs.ruby-lang.org/en/2.3.0/Object.html">Object</a></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>For use in case statements, so you can see if a string is a valid TID</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>, <tt><a href="https://docs.ruby-lang.org/en/2.3.0/Object.html">Object</a></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


47
48
49
50
51
52
53
54</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/at_protocol/tid_ext.rb', line 47</span>

<span class='kw'>def</span> <span class='id identifier rubyid_str?'>str?</span><span class='lparen'>(</span><span class='id identifier rubyid_s'>s</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='id identifier rubyid_s'>s</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_tid'>to_tid</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='id identifier rubyid_s'>s</span>
  <span class='id identifier rubyid_o'>o</span> <span class='op'>=</span> <span class='const'>Object</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='kw'>def</span> <span class='id identifier rubyid_o'>o</span><span class='period'>.</span><span class='op'>===</span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span>
    <span class='const'><span class='object_link'><a href="../ATProto.html" title="ATProto (module)">ATProto</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="ATProto::TID (class)">TID</a></span></span><span class='period'>.</span><span class='id identifier rubyid_from_string'><span class='object_link'><a href="#from_string-class_method" title="ATProto::TID.from_string (method)">from_string</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_str'>str</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span> <span class='op'>==</span> <span class='id identifier rubyid_str'>str</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_o'>o</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="<=>-instance_method">
  
    #<strong>&lt;=&gt;</strong>(other)  &#x21d2; <tt><a href="https://docs.ruby-lang.org/en/2.3.0/Integer.html">Integer</a></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>other</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="ATProto::TID (class)">ATProto::TID</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><a href="https://docs.ruby-lang.org/en/2.3.0/Integer.html">Integer</a></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


33
34
35</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/at_protocol/tid_ext.rb', line 33</span>

<span class='kw'>def</span> <span class='op'>&lt;=&gt;</span><span class='lparen'>(</span><span class='id identifier rubyid_other'>other</span><span class='rparen'>)</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_to_time'>to_time</span><span class='comma'>,</span> <span class='id identifier rubyid_clock_id'>clock_id</span><span class='rbracket'>]</span> <span class='op'>&lt;=&gt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_to_time'>to_time</span><span class='comma'>,</span> <span class='id identifier rubyid_other'>other</span><span class='period'>.</span><span class='id identifier rubyid_clock_id'>clock_id</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="clock_id-instance_method">
  
    #<strong>clock_id</strong>  &#x21d2; <tt><a href="https://docs.ruby-lang.org/en/2.3.0/Object.html">Object</a></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


88
89
90
91
92
93</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/at_protocol/tid.c', line 88</span>

static VALUE tid_get_clock_identifier(VALUE self) {
  TID *tid;
  Data_Get_Struct(self, TID, tid);

  return LL2NUM(tid-&gt;clock_identifier);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="inspect-instance_method">
  
    #<strong>inspect</strong>  &#x21d2; <tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25
26
27</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/at_protocol/tid_ext.rb', line 25</span>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>#&lt;ATProto::TID(</span><span class='embexpr_beg'>#{</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='embexpr_end'>}</span><span class='tstring_content'>)&gt;</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="succ-instance_method">
  
    #<strong>succ</strong>  &#x21d2; <tt><span class='object_link'><a href="" title="ATProto::TID (class)">ATProto::TID</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="ATProto::TID (class)">ATProto::TID</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


39
40
41</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/at_protocol/tid_ext.rb', line 39</span>

<span class='kw'>def</span> <span class='id identifier rubyid_succ'>succ</span>
  <span class='const'><span class='object_link'><a href="../ATProto.html" title="ATProto (module)">ATProto</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="ATProto::TID (class)">TID</a></span></span><span class='period'>.</span><span class='id identifier rubyid_new'><span class='object_link'><a href="#initialize-instance_method" title="ATProto::TID#initialize (method)">new</a></span></span><span class='lparen'>(</span><span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_to_time'>to_time</span> <span class='op'>+</span> <span class='int'>1</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_s-instance_method">
  
    #<strong>to_s</strong>  &#x21d2; <tt><a href="https://docs.ruby-lang.org/en/2.3.0/Object.html">Object</a></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


72
73
74
75
76
77
78
79
80
81
82
83
84
85
86</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/at_protocol/tid.c', line 72</span>

static VALUE tid_to_s(VALUE self) {
  TID *tid;
  Data_Get_Struct(self, TID, tid);

  char tid_str[14];
  for (int i = 0; i &lt; 11; i++) {
    int index = (int)((tid-&gt;timestamp &gt;&gt; (50 - i * 5)) &amp; 0x1F);
    tid_str[i] = b32_chars[index];
  }
  tid_str[11] = b32_chars[(int)(tid-&gt;clock_identifier &gt;&gt; 5) &amp; 0x1F]; // Update encoding
  tid_str[12] = b32_chars[(int)tid-&gt;clock_identifier &amp; 0x1F];
  tid_str[13] = &#39;\0&#39;;

  return rb_str_new_cstr(tid_str);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_time-instance_method">
  
    #<strong>to_time</strong>  &#x21d2; <tt><a href="https://docs.ruby-lang.org/en/2.3.0/Object.html">Object</a></tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65
66
67
68
69
70</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/at_protocol/tid.c', line 62</span>

static VALUE tid_to_time(VALUE self) {
  TID *tid;
  Data_Get_Struct(self, TID, tid);

  VALUE sec = LL2NUM(tid-&gt;timestamp / 1000000);
  VALUE usec = LL2NUM(tid-&gt;timestamp % 1000000);

  return rb_funcall(rb_cTime, rb_intern(&quot;at&quot;), 2, sec, usec);
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Tue Nov 14 18:18:43 2023 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.34 (ruby-3.2.2).
</div>

    </div>
  </body>
</html>